<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.busking.board.model.BoardTeamMapper">

	<select id="getList" parameterType="com.busking.util.paging.PageVO" resultType="com.busking.board.model.BoardTeamDTO">
		
		SELECT TEAM_NUM, TEAM_TITLE, TEAM_WRITER, TEAM_REGDATE, TEAM_HIT, TEAM_COUNT, TEAM_RESULT  
		FROM (
			SELECT ROWNUM RN,
			       T.* 
			FROM BOARD_TEAM T 
			ORDER BY TEAM_NUM DESC 
		) 
		WHERE RN > (#{pageNum} - 1) * #{amount} and #{pageNum} * #{amount} >= RN 				
	</select>
	
	<select id="getTotal" resultType="int">
		SELECT COUNT(*) FROM BOARD_TEAM 
	</select>
	
	<insert id="write" parameterType="com.busking.board.model.BoardTeamDTO">
		INSERT INTO BOARD_TEAM(TEAM_NUM, 
							   TEAM_WRITER, 
							   TEAM_TITLE,
							   TEAM_CONTENT,
							   TEAM_REGDATE,
							   TEAM_COUNT,
							   TEAM_RESULT) 
		VALUES('TEAM_' || LPAD(BOARD_TEAM_SEQ.NEXTVAL, 8, '0'),
		       #{teamWriter},
		       #{teamTitle},
		       #{teamContent},
		       SYSDATE,
		       #{teamCount},
		       #{teamResult}) 
	</insert>
	
	<select id="getContent" resultType="com.busking.board.model.BoardTeamDTO" parameterType="String">
		SELECT TEAM_TITLE, 
		       TEAM_LIKE_COUNT, 
		       TEAM_WRITER, 
		       TEAM_REGDATE, 
		       TEAM_CONTENT, 
		       TEAM_HIT, 
		       TEAM_CMT_COUNT, 
		       TEAM_RESULT, 
		       TEAM_COUNT 
		FROM BOARD_TEAM 
		WHERE TEAM_NUM = #{teamNum}
	</select>
	
	<update id="increaseHit" parameterType="String">
		UPDATE BOARD_TEAM SET TEAM_HIT = TEAM_HIT + 1 WHERE TEAM_NUM = #{teamNum}
	</update>
	
	<delete id="delete" parameterType="String">
		DELETE FROM BOARD_TEAM WHERE TEAM_NUM = #{teamNum}
	</delete>
	
	<update id="edit" parameterType="com.busking.board.model.BoardTeamDTO">
		UPDATE BOARD_TEAM 
		SET TEAM_TITLE = #{teamTitle}, 
		    TEAM_CONTENT = #{teamContent}, 
		    TEAM_COUNT = #{teamCount}, 
		    TEAM_RESULT = #{teamResult} 
		WHERE TEAM_NUM = #{teamNum} 
	</update>

</mapper>